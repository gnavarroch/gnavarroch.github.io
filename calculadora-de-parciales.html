<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculadora de Parciales - Trading</title>
<link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/2643/2643883.png"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Poppins:wght@600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<style>
body { font-family:'Inter',sans-serif; margin:0; padding:50px 20px; display:flex; justify-content:center; background:#f0f4f8; transition:background 0.3s,color 0.3s; color:#000; }
body.dark { background:#121212; color:#e0e0e0; }

.container { background:#ffffffcc; backdrop-filter:blur(10px); padding:40px 35px; border-radius:24px; box-shadow:0 15px 35px rgba(0,0,0,0.2); max-width:580px; width:100%; transition:all 0.3s; position:relative;}
body.dark .container { background:#1e1e1ecc; box-shadow:0 15px 35px rgba(0,0,0,0.7);}
.container:hover { transform:translateY(-4px);}

.theme-toggle { position:absolute; top:15px; right:15px; background:#f0f0f0; border:none; border-radius:50%; width:40px; height:40px; cursor:pointer; font-size:18px; display:flex; align-items:center; justify-content:center; transition:0.3s; box-shadow:0 3px 8px rgba(0,0,0,0.15);}
.theme-toggle:hover { transform:scale(1.1);}
body.dark .theme-toggle { background:#2a2a2a; color:#ffd43b; }

h1 { font-family:'Poppins',sans-serif; text-align:center; margin-bottom:10px; font-size:2.1em; }
h2 { text-align:center; font-size:1.1em; color:#555; margin-bottom:25px; }
body.dark h2 { color:#ccc; }

label { font-weight:600; margin-top:15px; display:block; font-size:15px; }
.input-with-tooltip { display:flex; align-items:center; gap:6px; }
.tooltip { position:relative; display:inline-block; cursor:pointer; color:#007BFF; font-size:14px; }
.tooltip .tooltiptext { visibility:hidden; width:200px; background:#333; color:#fff; text-align:left; border-radius:8px; padding:8px; position:absolute; z-index:1; bottom:125%; left:50%; margin-left:-100px; opacity:0; transition:opacity 0.3s;}
.tooltip:hover .tooltiptext { visibility:visible; opacity:1; }

input { width:100%; padding:12px; margin-top:6px; border-radius:10px; border:1px solid #ccc; font-size:16px; transition:0.3s; background:#fff; color:#000; box-sizing:border-box;}
body.dark input { background:#2a2a2a; color:#e0e0e0; border:1px solid #555;}
input:focus { border:2px solid #007BFF; outline:none; box-shadow:0 0 8px rgba(0,123,255,0.5);}

button { margin-top:15px; width:100%; padding:14px; border:none; border-radius:14px; background:linear-gradient(90deg,#007BFF,#00C6FF); color:white; font-weight:600; font-size:16px; cursor:pointer; transition:0.2s; display:flex; align-items:center; justify-content:center; gap:8px; }
button:hover { transform:translateY(-2px); box-shadow:0 6px 16px rgba(0,0,0,0.2);}
.reset-btn { background:linear-gradient(90deg,#FF4D4D,#FF7B7B); margin-top:10px;}
.reset-btn:hover { box-shadow:0 6px 16px rgba(255,0,0,0.25); }

table { width:100%; border-collapse:collapse; margin-top:20px; border-radius:14px; overflow:hidden; box-shadow:0 5px 15px rgba(0,0,0,0.1);}
body.dark table { box-shadow:0 5px 15px rgba(0,0,0,0.6);}
th, td { padding:14px; text-align:center; border-bottom:1px solid #ddd; font-size:15px; }
body.dark th, body.dark td { border-bottom:1px solid #555; color:#e0e0e0;}
th { background:#007BFF; color:white; font-size:15px; }
tr:last-child td { border-bottom:none; }

.remove-btn { background:#FF4D4D; border:none; border-radius:8px; padding:8px 14px; color:white; cursor:pointer; font-weight:bold; transition:0.2s; display:flex; align-items:center; justify-content:center; gap:5px; }
.remove-btn:hover { transform:scale(1.1);}

#resultado { margin-top:30px; font-size:1.25em; font-weight:bold; text-align:center; padding:15px; border-radius:14px; transition:0.3s; box-shadow: inset 0 2px 6px rgba(0,123,255,0.1);}
#resultado.verde { background:#e6ffe6; color:#2e7d32; box-shadow: inset 0 2px 6px rgba(46,125,50,0.2);}
#resultado.rojo { background:#ffe6e6; color:#c62828; box-shadow: inset 0 2px 6px rgba(198,40,40,0.2);}
#resultado.gris { background:#f0f0f0; color:#555; box-shadow: inset 0 2px 6px rgba(0,0,0,0.05);}
body.dark #resultado.verde { background:#1b3321; color:#81c784; box-shadow: inset 0 2px 6px rgba(129,199,132,0.2);}
body.dark #resultado.rojo { background:#331b1b; color:#ef5350; box-shadow: inset 0 2px 6px rgba(239,83,80,0.2);}
body.dark #resultado.gris { background:#2a2a2a; color:#aaa; box-shadow: inset 0 2px 6px rgba(255,255,255,0.05);}

#capitalBlock { margin-top:20px; padding:0; border-radius:16px; max-height:0; overflow:hidden; opacity:0; transition:max-height 0.5s ease, opacity 0.5s ease, padding 0.5s; }
#capitalBlock.show { padding:20px; max-height:500px; opacity:1; background:#f9f9f9; box-shadow:0 4px 12px rgba(0,0,0,0.1);}
body.dark #capitalBlock.show { background:#2a2a2a; }

#warning { margin-top:12px; text-align:center; font-size:14px; font-weight:bold; color:red; display:none; }

.conclusion { margin-top:18px; font-size:14px; line-height:1.6; text-align:center; color:#444; }
body.dark .conclusion { color:#bbb; }

.creditos { margin-top:25px; font-size:12px; text-align:center; color:#555; }
.creditos a { color:#007BFF; text-decoration:none; font-weight:600;}
.creditos a:hover { text-decoration:underline;}

.parcial-positivo { background-color:#d4f8d4; transition:0.3s; }
input.error { border:2px solid red !important; }
</style>
</head>
<body>

<div class="container">
    <button id="toggleTheme" class="theme-toggle"><i class="fa-solid fa-moon"></i></button>

    <h1>Calculadora de Parciales</h1>
    <h2>Controla tus ganancias al tomar parciales en tus trades.</h2>

    <label for="riesgo">Riesgo inicial ($):</label>
    <input type="number" id="riesgo" placeholder="Ej: 100" oninput="calcular()">

    <button onclick="agregarParcial()"><i class="fa-solid fa-plus"></i> Agregar parcial</button>
    <button class="reset-btn" onclick="resetear()"><i class="fa-solid fa-rotate-left"></i> Reset</button>

    <table id="tablaParciales">
        <thead>
            <tr>
                <th>
                    % de posición 
                    <span class="tooltip"><i class="fa-solid fa-circle-info"></i>
                        <span class="tooltiptext">Porcentaje de tu posición que cierras en este parcial (ej: 50% de la operación).</span>
                    </span>
                </th>
                <th>
                    Ganancia (R:R) 
                    <span class="tooltip"><i class="fa-solid fa-circle-info"></i>
                        <span class="tooltiptext">Relación riesgo-beneficio (ej: 2 significa 2 veces lo que arriesgaste).</span>
                    </span>
                </th>
                <th>Acción</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><input type="number" class="porcentaje" placeholder="50" oninput="calcular()"></td>
                <td><input type="number" class="rr" placeholder="1" oninput="calcular()"></td>
                <td><button class="remove-btn" onclick="eliminarFila(this)"><i class="fa-solid fa-xmark"></i></button></td>
            </tr>
        </tbody>
    </table>

    <div id="warning">⚠️ La suma de parciales excede el 100%</div>

    <div id="resultado" class="gris">Multiplicador: 0x | Ganancia total: $0 | +0%</div>

    <div style="margin-top: 20px; text-align:center;">
        <button type="button" onclick="toggleCapitalBlock()">📊 Ver impacto en la cuenta</button>
    </div>

    <div id="capitalBlock">
        <h3>Impacto sobre el capital</h3>
        <label for="capital">Capital total de la cuenta ($):</label>
        <input type="number" id="capital" placeholder="Ej: 1000" oninput="guardarDatos()" />

        <button type="button" onclick="calcularImpacto()">Calcular impacto</button>

        <div id="resultadoCapital" style="margin-top:15px; font-size:1.1em; font-weight:bold;"></div>
    </div>

    <div class="conclusion">
        <i class="fa-solid fa-lightbulb"></i> El <strong>multiplicador</strong> indica cuántas veces tu riesgo inicial fue convertido en ganancia.<br>
        La <strong>ganancia total</strong> muestra el beneficio acumulado en $ y en <strong>% sobre el riesgo</strong>.
    </div>

    <div class="creditos">
        Calculadora por <strong><a href="https://www.skool.com/@gabriel-navarro-3956?g=ef-trading" target="_blank">Gabo</a></strong>, miembro de <a href="https://www.skool.com/ef-trading" target="_blank">EF Trading</a>
    </div>
</div>

<script>
const themeBtn = document.getElementById('toggleTheme');
const icon = themeBtn.querySelector("i");
let beneficioTotal = 0;

themeBtn.addEventListener('click', () => {
    document.body.classList.toggle('dark');
    if(document.body.classList.contains('dark')){
        icon.classList.replace("fa-moon","fa-sun");
    } else {
        icon.classList.replace("fa-sun","fa-moon");
    }
});

function agregarParcial(porcentaje="", rr="") {
    const tbody = document.querySelector("#tablaParciales tbody");
    const fila = document.createElement("tr");
    fila.innerHTML = `
        <td><input type="number" class="porcentaje" placeholder="25" value="${porcentaje}" oninput="calcular()"></td>
        <td><input type="number" class="rr" placeholder="2" value="${rr}" oninput="calcular()"></td>
        <td><button class="remove-btn" onclick="eliminarFila(this)"><i class="fa-solid fa-xmark"></i></button></td>
    `;
    tbody.appendChild(fila);
    calcular();
}

function eliminarFila(boton) {
    boton.closest('tr').remove();
    calcular();
}

function resetear() {
    document.getElementById('riesgo').value = "";
    document.getElementById('capital').value = "";
    document.querySelector("#tablaParciales tbody").innerHTML = `
        <tr>
            <td><input type="number" class="porcentaje" placeholder="50" oninput="calcular()"></td>
            <td><input type="number" class="rr" placeholder="1" oninput="calcular()"></td>
            <td><button class="remove-btn" onclick="eliminarFila(this)"><i class="fa-solid fa-xmark"></i></button></td>
        </tr>`;
    document.getElementById('resultado').innerText = "Multiplicador: 0x | Ganancia total: $0 | +0%";
    document.getElementById('resultado').className = "gris";
    document.getElementById('resultadoCapital').innerText = "";
    localStorage.removeItem("parcialesData");
}

function calcular() {
    const riesgo = parseFloat(document.getElementById('riesgo').value) || 0;
    const filas = document.querySelectorAll('#tablaParciales tbody tr');
    beneficioTotal = 0;
    let sumaParciales = 0;

    filas.forEach(fila => {
        fila.classList.remove('parcial-positivo');
        const porcentajeInput = fila.querySelector('.porcentaje');
        const rrInput = fila.querySelector('.rr');
        const porcentaje = parseFloat(porcentajeInput.value) || 0;
        const rr = parseFloat(rrInput.value) || 0;
        sumaParciales += porcentaje;
        const ganancia = (porcentaje/100)*riesgo*rr;
        beneficioTotal += ganancia;
        if(ganancia>0) fila.classList.add('parcial-positivo');
    });

    // Validación visual
    if(sumaParciales>100) document.getElementById('warning').style.display = "block";
    else document.getElementById('warning').style.display = "none";

    const multiplicador = riesgo>0 ? (beneficioTotal/ riesgo) : 0;
    const porcentajeGanancia = riesgo>0 ? (beneficioTotal/ riesgo)*100 : 0;

    const resultado = document.getElementById('resultado');
    resultado.innerText = `Multiplicador: ${multiplicador.toFixed(2)}x | Ganancia total: $${beneficioTotal.toFixed(2)} | ${porcentajeGanancia.toFixed(2)}%`;

   
